---
layout: post
title: "Writing an Android component for React Native"
date: 2016-06-11 16:27:06 +00:00
categories: react-native
author: Guillermo Orellana
comments: true
tags: react-native,google
---

One of the cool things I like from working at Badoo ([we are hiring!](https://corp.badoo.com/jobs/)), is that we are free to propose, test and promote new or different techniques, technologies and libraries. React Native has been the buzzword for a while now, but recently it gained our attention.

Main concerns that came to our mind were the size of the existing codebase (let's say, sizeable), our highly customised classes to fit our needs and easiness of integration. I decided to test the middle one, and try to write a custom Android component to use in React Native.

# React Native

Probably almost everybody has already heard about React Native, but if you have not, **TLDR:** it makes use of JavaScript and React but builds a native UI thanks to some clever bridge techniques.

You can find all about it in the [project page]().

If you generate a demo project by invoking `react-native init`, you will get a working skeleton, which is the one I will base the post on.

![]()

Let's attempt to extend it by adding a simple `ProgressBar`. This is already implemented as part of the standard React Native distribution, but will serve us as a easy sample.

# Android side

Extensions to the existing bindings are made by implementing the `ReactPackage` class. It can be done in three different ways:

### 1. Native Modules
They provide an inteface for JavaScript code to call native Java methods. For instance, exposing the Toast API as done in the documentation examples. 

C++ native modules are provided in a different way, so they can be fully cross-platform.

### 2. JavaScript Modules
Basically the opposite way around: When you call on a method of a class implementing this interface, the equivalent will be called on the JavaScript realm.

### 3. ViewManagers
Native views are provided through implementations of the `ViewManager` class, responsible of instantianting and updating views of a given type. This is the one we are interested in for now.

Since we are only setting up a native view component, we will need to go from the ViewManager all the way up through several layers.

## The ViewManager
All `ViewManager` instances need to report two things: a name to be mapped to a React class, and a way to create an instance of the view they manage. For our `ProgressBar` example, this is quite easy.

```java
public class ProgressBarViewManager
        extends SimpleViewManager<ProgressBar> {

    public static final String REACT_CLASS = "ProgressBar";

    @Override
    public String getName() {
        return REACT_CLASS;
    }

    @Override
    protected ProgressBar createViewInstance(
            ThemedReactContext reactContext) {
        return new ProgressBar(reactContext);
    }
}
```

Here, `ThemedReactContext` is just a wrapper on top of the Android `Context` we all know (and perhaps hate).

With this done, React Native is able to instantiate a `ProgressBar` each time it finds the JSX tag for it.

## The Package

At the package level, we do not need to return anything but our brand new `ViewManager`

```java
@Override
public List<ViewManager> createViewManagers(
        ReactApplicationContext reactContext) {
    return Collections.<ViewManager>singletonList(
            new ProgressBarViewManager()
    );
}
```

The rest of methods can return empty collections safely for now, since we do not need anything from them.

## The entrypoint: ReactActivity 

The entrypoint of the boilerplate code generated by `react-native init` is a subclass of `ReactActivity`, which saves us from a lot of configuration. We just need to add the new package to the list of packages reported to the JavaScript side, and we are more than done on native world.

```java
@Override
protected List<ReactPackage> getPackages() {
    return Arrays.asList(
            new MainReactPackage(),
            new ProgressBarPackage()
    );
}
```

# JavaScript (React) side



# Exposing view properties
```java
@ReactProp(name = "progress", defaultInt = 0)
public void setProgress(ProgressBar view, int progress) {
    view.setProgress(progress);
}

@ReactProp(name = "indeterminate",
        defaultBoolean = false)
public void setIndeterminate(ProgressBar view,
                             boolean indeterminate) {
    view.setIndeterminate(indeterminate);
}
```

# All together

# Aftermath

